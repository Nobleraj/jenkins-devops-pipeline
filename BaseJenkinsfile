pipeline {
    agent any

    environment {
        DOCKER_REGISTRY_URL = 'localhost:5000'
        DOCKER_REGISTRY_CREDENTIALS = credentials('docker-registry-credentials')
    }

    stages {
        stage('Build base image') {
            steps {
                script {
                    // Build the Docker image
                    docker.build('baseimage:v1')
                }
            }
        }
    }
     stage('Push') {
            steps {
                // Push Docker image to local registry
                withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'docker-registry-credentials', usernameVariable: 'DOCKER_USERNAME', passwordVariable: 'DOCKER_PASSWORD']]) {
                    sh "docker login $DOCKER_REGISTRY_URL -u $DOCKER_USERNAME -p $DOCKER_PASSWORD"
                    sh "docker push $DOCKER_REGISTRY_URL/baseimage:v1"
                }
            }
    }
}
